<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- å¼•å…¥æ€æºå®‹ä½“ï¼Œä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ -->
<link href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
<title>ç”µå­æ‰‹æŠ„è¯—ç¬º Â· æ–‡æ˜å›å“</title>
<script src="https://lib.baomitu.com/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    margin: 0;
    background: #f9f5f0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px 20px;
    box-sizing: border-box;
    font-family: "Noto Serif SC", "KaiTi", "æ¥·ä½“", serif;
  }
  .paper {
    width: 100%;
    max-width: 700px;
    background: #fffef7;
    border: 1px solid #e8d8c8;
    border-radius: 16px;
    padding: 100px 70px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.18);
    position: relative;
    overflow: hidden;
  }
  .paper::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(45deg, transparent, transparent 10px, #f0e6d8 10px, #f0e6d8 11px),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M0,100 Q50,60 100,100 T200,100 M100,0 Q60,50 100,100 T100,200" stroke="%23e8d8c8" stroke-width="1" fill="none"/></svg>');
    opacity: 0.3;
    pointer-events: none;
  }
  .title {
    text-align: center;
    font-size: 38px;
    color: #5d4037;
    margin-bottom: 80px;
    letter-spacing: 12px;
    font-weight: normal;
  }
  .poem {
    font-size: 34px;
    line-height: 2.8;
    text-align: center;
    color: #3e2723;
    margin: 100px 0;
    white-space: pre-line;
  }
  .author {
    text-align: center;
    font-size: 26px;
    color: #8d6e63;
    margin-top: 80px;
  }
  .signature {
    text-align: right;
    margin-top: 140px;
    font-size: 22px;
    color: #a1887f;
    border-top: 1px solid #e8d8c8;
    padding-top: 30px;
    width: 70%;
    margin-left: auto;
  }
  .actions {
    text-align: center;
    margin: 50px 0;
  }
  button {
    padding: 16px 40px;
    font-size: 20px;
    background: #8d6e63;
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    margin: 0 15px;
    transition: all 0.3s;
  }
  button:hover {
    background: #6d4c41;
    transform: translateY(-4px);
  }
  .save-btn {
    background: #e74c3c;
  }
  .save-btn:hover {
    background: #c0392b;
  }
  .tip {
    text-align: center;
    font-size: 16px;
    color: #a1887f;
    margin-top: 30px;
    line-height: 1.8;
  }

  /* ç§»åŠ¨ç«¯é€‚é… */
  @media (max-width: 768px) {
    body {
      padding: 20px 10px;
    }
    
    .paper {
      padding: 60px 30px;
      max-width: 100%;
    }
    
    .title {
      font-size: 28px;
      margin-bottom: 50px;
      letter-spacing: 8px;
    }
    
    .poem {
      font-size: 26px;
      line-height: 2.4;
      margin: 60px 0;
    }
    
    .author {
      font-size: 20px;
      margin-top: 50px;
    }
    
    .signature {
      margin-top: 80px;
      font-size: 18px;
      width: 90%;
    }
    
    .actions {
      margin: 30px 0;
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }
    
    button {
      margin: 0;
      padding: 14px 32px;
      font-size: 18px;
      width: 100%;
    }
    
    .tip {
      font-size: 14px;
      margin-top: 20px;
    }
  }
</style>
</head>
<body>

<div class="paper" id="capture">
  <h1 class="title" id="pageTitle">æ‰‹æŠ„è¯—ç¬º</h1>
  <div class="poem" id="poemText"></div>
  <p class="author" id="poemAuthor"></p>
  <div class="signature" id="signatureLine">
    æŠ„äº äºŒã€‡äºŒäº”å¹´åäºŒæœˆã€€ã€€æŠ„ä¹¦äººï¼š<span id="copyistName">________________</span>
  </div>
</div>

<div class="actions">
  <button class="save-btn" onclick="saveAsImage()">ğŸ“¥ ä¿å­˜ä¸ºå›¾ç‰‡</button>
  <button onclick="location.href='/elder-home.html'">â† è¿”å›è¯—å»Š</button>
</div>

<p class="tip">
  ğŸ’¡ é•¿æŒ‰å›¾ç‰‡æˆ–å³é”®ä¿å­˜ Â· å¯å‘å¾®ä¿¡ã€æœ‹å‹åœˆã€å­˜ç›¸å†Œ
</p>

<script>
// é»˜è®¤ç»å…¸è¯—åº“
const defaultPoems = {
  "é™å¤œæ€": { text: "åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚\nä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚", author: "æç™½" },
  "æ˜¥æ™“": { text: "æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿã€‚\nå¤œæ¥é£é›¨å£°ï¼ŒèŠ±è½çŸ¥å¤šå°‘ã€‚", author: "å­Ÿæµ©ç„¶" },
  "ç™»é¹³é›€æ¥¼": { text: "ç™½æ—¥ä¾å±±å°½ï¼Œé»„æ²³å…¥æµ·æµã€‚\næ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚", author: "ç‹ä¹‹æ¶£" },
  "æ«æ¡¥å¤œæ³Š": { text: "æœˆè½ä¹Œå•¼éœœæ»¡å¤©ï¼Œæ±Ÿæ«æ¸”ç«å¯¹æ„çœ ã€‚\nå§‘è‹åŸå¤–å¯’å±±å¯ºï¼Œå¤œåŠé’Ÿå£°åˆ°å®¢èˆ¹ã€‚", author: "å¼ ç»§" },
  "ç›¸æ€": { text: "çº¢è±†ç”Ÿå—å›½ï¼Œæ˜¥æ¥å‘å‡ æã€‚\næ„¿å›å¤šé‡‡æ’·ï¼Œæ­¤ç‰©æœ€ç›¸æ€ã€‚", author: "ç‹ç»´" },
  "ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ": { text: "ç‹¬åœ¨å¼‚ä¹¡ä¸ºå¼‚å®¢ï¼Œæ¯é€¢ä½³èŠ‚å€æ€äº²ã€‚\né¥çŸ¥å…„å¼Ÿç™»é«˜å¤„ï¼Œéæ’èŒ±è¸å°‘ä¸€äººã€‚", author: "ç‹ç»´" }
};

// åŠ è½½è‡ªå®šä¹‰è¯—æ­Œå’ŒæŠ„ä¹¦äººå§“å
let customPoems = JSON.parse(localStorage.getItem("customPoems") || "{}");
let copyistName = localStorage.getItem("copyistName") || "";

const allPoems = { ...defaultPoems, ...customPoems };

// URL å‚æ•°è§£æ
const urlParams = new URLSearchParams(location.search);
let selectedTitle = urlParams.get("poem") || urlParams.get("title") || "é™å¤œæ€";
let isCustom = urlParams.get("custom") === "1";
let poem = {}; // åœ¨å¤–éƒ¨å£°æ˜ poem å˜é‡

const storedPoem = sessionStorage.getItem('currentPoem');

if (storedPoem) {
  const { title, text, author } = JSON.parse(storedPoem);
  selectedTitle = title;
  poem = { text, author };
  sessionStorage.removeItem('currentPoem'); // æ¸…ç†
} else if (isCustom) {
  const customText = urlParams.get("text") || "";
  const customAuthor = urlParams.get("author") || "ä½šå";
  poem = { text: customText, author: customAuthor };
} else {
  poem = allPoems[selectedTitle] || defaultPoems["é™å¤œæ€"];
}

// æ¸²æŸ“
document.getElementById("pageTitle").textContent = selectedTitle;
document.getElementById("poemText").textContent = poem.text;
document.getElementById("poemAuthor").textContent = `â€”â€” ${poem.author} â€”â€”`;
document.getElementById("copyistName").textContent = copyistName || "________________";

// ä¿å­˜ä¸ºå›¾ç‰‡
async function saveAsImage() {
  const element = document.getElementById("capture");
  const button = document.querySelector(".save-btn");
  button.textContent = "ç”Ÿæˆä¸­â€¦";

  try {
    const canvas = await html2canvas(element, {
      scale: 3,
      useCORS: true,
      backgroundColor: "#fffef7"
    });

    const link = document.createElement("a");
    link.download = `${selectedTitle} - æ‰‹æŠ„è¯—ç¬º - æ–‡æ˜å›å“.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();

    button.textContent = "ğŸ“¥ ä¿å­˜æˆåŠŸï¼";
    setTimeout(() => button.textContent = "ğŸ“¥ ä¿å­˜ä¸ºå›¾ç‰‡", 2000);
  } catch (err) {
    alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•");
    button.textContent = "ğŸ“¥ ä¿å­˜ä¸ºå›¾ç‰‡";
  }
}
</script>

</body>
</html>