<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<script>
  if (/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
    window.location.href = 'm-creation.html';
  }
</script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    // åªæœ‰éç§»åŠ¨ç«¯æ‰åŠ è½½å¤–éƒ¨å­—ä½“
    if (!/Mobi|Android|iPhone/i.test(navigator.userAgent)) {
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = 'https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;700&display=swap';
      document.head.appendChild(link);
    }
  </script>
<title>è¯—è¯æ··åˆ›å·¥åŠ Â· æ–‡æ˜å›å“</title>
<style>
  body {
    margin: 0;
    font-family: "Noto Serif SC", "å®‹ä½“", serif;
    background: linear-gradient(to bottom, #0a0e17, #1a2332);
    color: #e8e6e3;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
    box-sizing: border-box;
  }
  .container {
    width: 90%;
    max-width: 900px;
    background: rgba(255,255,255,0.06);
    border-radius: 20px;
    padding: 50px;
    box-shadow: 0 15px 50px rgba(0,0,0,0.5);
    backdrop-filter: blur(12px);
  }
  h1 {
    text-align: center;
    font-size: 36px;
    color: #f1c40f;
    margin-bottom: 20px;
  }
  p {
    text-align: center;
    font-size: 18px;
    color: #bdc3c7;
    margin-bottom: 40px;
  }
  .input-area {
    background: rgba(0,0,0,0.3);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
  }
  textarea {
    width: 100%;
    height: 100px;
    padding: 16px;
    font-size: 20px;
    background: transparent;
    color: #fff;
    border: 1px solid #444;
    border-radius: 12px;
    resize: none;
    font-family: inherit;
  }
  textarea::placeholder {
    color: #888;
  }
  .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 20px 0;
    flex-wrap: wrap;
    gap: 15px;
  }
  select {
    padding: 12px 20px;
    font-size: 16px;
    background: #222;
    color: #fff;
    border: none;
    border-radius: 30px;
  }
  button {
    padding: 14px 36px;
    font-size: 18px;
    background: #e74c3c;
    color: white;
    border: none;
    border-radius: 50px;
    cursor: pointer;
  }
  button:hover {
    background: #c0392b;
    transform: scale(1.05);
  }
  .poem-result {
    background: rgba(0,0,0,0.4);
    border-radius: 16px;
    padding: 30px;
    font-size: 24px;
    line-height: 2.4;
    white-space: pre-line;
    min-height: 150px;
    text-align: center;
  }
  .user-line {
    color: #f1c40f;
    font-weight: bold;
  }
  .ai-line {
    color: #87CEEB;
  }
  .tip {
    text-align: center;
    font-size: 15px;
    color: #95a5a6;
    margin-top: 40px;
    line-height: 1.7;
  }
  .back-btn {
    margin-top: 40px;
    padding: 12px 30px;
    background: #34495e;
    font-size: 16px;
  }

  /* ç§»åŠ¨ç«¯é€‚é… */
  @media (max-width: 768px) {
    body {
      padding: 20px 10px;
    }
    
    .container {
      width: 100%;
      padding: 30px 15px;
      border-radius: 16px;
    }
    
    h1 {
      font-size: 26px;
      margin-bottom: 12px;
    }
    
    p {
      font-size: 15px;
      margin-bottom: 25px;
      line-height: 1.6;
    }
    
    .input-area {
      padding: 15px;
      margin-bottom: 20px;
    }
    
    textarea {
      height: 90px;
      font-size: 17px;
      padding: 12px;
    }
    
    .controls {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
      margin: 15px 0;
    }
    
    select {
      width: 100%;
      padding: 14px;
      font-size: 16px;
    }
    
    button {
      width: 100%;
      padding: 14px;
      font-size: 18px;
    }
    
    .poem-result {
      padding: 20px 15px;
      font-size: 19px;
      line-height: 2.0;
      min-height: 120px;
    }
    
    .tip {
      font-size: 13px;
      margin-top: 25px;
      padding: 0 10px;
    }
    
    .back-btn {
      margin-top: 25px;
      width: 100%;
      padding: 14px;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ–‹ï¸ è¯—è¯æ··åˆ›å·¥åŠ</h1>
  <p>ä½ èµ·ä¸€å¥ï¼Œæˆ‘ç»­ä¸‰å¥<br>æˆ‘ä»¬ä¸€èµ·ï¼Œä¸å¤äººåˆå†™æ–°è¯—</p>

  <div class="input-area">
    <textarea id="firstLine" placeholder="ä¾‹å¦‚ï¼šæˆ‘åœ¨åŸå¸‚çš„å¤œé‡Œï¼Œæƒ³èµ·è¿œæ–¹çš„å±±â€¦â€¦"></textarea>
    
    <div class="controls">
      <select id="mood">
        <option value="è‡ªç”±">è‡ªç”±æŒ¥æ´’</option>
        <option value="å­¤ç‹¬">æ·¡æ·¡å­¤ç‹¬</option>
        <option value="æ¼‚æ³Š">æ¼‚æ³Šè‹å‡‰</option>
        <option value="å–œæ‚¦">æ˜å¿«å–œæ‚¦</option>
        <option value="æ€å¿µ">æŸ”è½¯ç›¸æ€</option>
      </select>
      <button onclick="continuePoem()">AI ç»­å†™</button>
    </div>
  </div>

  <div class="poem-result" id="result">
    <em>ç­‰å¾…ä½ çš„å¼€å¤´â€¦â€¦</em>
  </div>

  <div class="actions" style="text-align: center; margin-top: 20px;">
    <button id="generate-letter-btn" style="display:none;" onclick="generateLetter()">ğŸ“œ ç”Ÿæˆæ‰‹æŠ„è¯—ç¬º</button>
  </div>

  <p class="tip">
    âš ï¸ AI åªè¾…åŠ©ç»­å†™ï¼Œä¸ä»£å†™å…¨è¯—<br>
    æœ€ç»ˆä½œå“å±äºä½ ï¼Œå¯ä¿å­˜ã€åˆ†äº«ã€æŠ•ç¨¿
  </p>

  <button class="back-btn" onclick="location.href='index.html'">
    è¿”å›é€‰æ‹©å…¥å£
  </button>
</div>

<script>
async function continuePoem() {
  const firstLine = document.getElementById("firstLine").value.trim();
  const mood = document.getElementById("mood").value;
  const result = document.getElementById("result");

  if (!firstLine) {
    result.innerHTML = "<em>è¯·å…ˆå†™ä¸‹ä½ çš„å¼€å¤´å“¦ï½</em>";
    return;
  }

  result.innerHTML = "<em>å¤äººæç¬”ï¼Œæ­£åœ¨ä¸ºä½ ç»­å†™â€¦â€¦</em>";

  try {
    // æ™ºèƒ½ API åŸºç¡€ URLï¼šæœ¬åœ°ç”¨ localhostï¼Œçº¿ä¸Šç”¨ Vercel
    const API_BASE_URL = window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1"
      ? "http://localhost:3000"
      : "https://civilization-echo.vercel.app";
    
    const res = await fetch(`${API_BASE_URL}/api/creation/continue`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ firstLine, mood })
    });

    const data = await res.json();
    const continuation = data.continuation || "äº‘æ·±ä¸çŸ¥å¤„ï¼Œæ¾é£è‡ªå¹å¯’ã€‚ä¸€å¶æ¢¦ç›¸å…³ã€‚";

    result.innerHTML = `
      <span class="user-line">ä½ ï¼š${firstLine}</span><br><br>
      <span class="ai-line">å¤äººç»­ï¼š</span><br>
      ${continuation}
    `;

    // æ˜¾ç¤ºç”Ÿæˆæ‰‹æŠ„è¯—ç¬ºæŒ‰é’®
    const generateBtn = document.getElementById("generate-letter-btn");
    generateBtn.style.display = "inline-block";
    window.currentPoem = {
      title: firstLine.substring(0, 10) + '...',
      text: firstLine + '\n' + continuation,
      author: 'ä½ ä¸å¤äºº'
    };

  } catch (err) {
    result.innerHTML = "<em>å¢¨æ±æ™•å¼€äº†ï¼Œå¤äººæš‚æœªè½ç¬”â€¦è¯·é‡è¯•</em>";
  }
}

function generateLetter() {
  if (window.currentPoem) {
    sessionStorage.setItem('currentPoem', JSON.stringify(window.currentPoem));
    window.location.href = 'poem-letter.html';
  }
}
</script>

</body>
</html>